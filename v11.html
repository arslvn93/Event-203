<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Your Seat | Blueprint Workshop</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts: Oswald (Headlines) & Roboto (Body) - The "ClickFunnels" Standard -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- External Config -->
    <script src="config.js"></script>

    <style>
        :root {
            --neon-green: #26ff79;
            --dark-green: #0a2812;
            --alert-red: #ff4d4d;
            --gold-start: #FDB931;
            --gold-end: #F79221;
            --bg-dark: #080808;
            --panel-bg: #121212;
        }

        body {
            background-color: var(--bg-dark);
            color: #ffffff;
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
        }

        h1, h2, h3, .font-heading {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* === THE "CONVERSION" BUTTON === */
        .btn-pulse {
            background: linear-gradient(to bottom, #ffe066 0%, #e6b800 100%);
            border: 1px solid #fff;
            border-bottom: 4px solid #b28f00;
            border-radius: 6px;
            color: #000;
            font-family: 'Oswald', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            text-shadow: 0px 1px 0px rgba(255,255,255,0.4);
            box-shadow: 0px 0px 20px rgba(255, 215, 0, 0.4);
            transition: all 0.15s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .btn-pulse:hover {
            transform: translateY(1px);
            border-bottom-width: 3px;
            filter: brightness(1.1);
            box-shadow: 0px 0px 30px rgba(255, 215, 0, 0.6);
        }
        
        .btn-pulse:active {
            transform: translateY(4px);
            border-bottom-width: 0px;
        }

        /* Shine Effect Animation */
        .btn-pulse::after {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.8) 50%, rgba(255,255,255,0) 100%);
            transform: rotate(45deg);
            animation: buttonShine 3s infinite;
        }

        @keyframes buttonShine {
            0% { left: -100%; opacity: 0; }
            20% { left: 100%; opacity: 1; }
            100% { left: 100%; opacity: 0; }
        }

        /* === PROGRESS BAR === */
        .progress-container {
            width: 100%;
            background-color: #333;
            border-radius: 50px;
            margin: 15px 0;
            border: 1px solid #444;
        }
        .progress-bar {
            width: 85%;
            height: 12px;
            background: repeating-linear-gradient(
                45deg,
                #dc2626,
                #dc2626 10px,
                #ef4444 10px,
                #ef4444 20px
            );
            border-radius: 50px;
            animation: progressMove 1s linear infinite;
        }
        @keyframes progressMove {
            0% { background-position: 0 0; }
            100% { background-position: 40px 0; }
        }

        /* === CARDS === */
        .funnel-card {
            background: var(--panel-bg);
            border: 1px solid #222;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .highlight-text {
            background-color: rgba(38, 255, 121, 0.15);
            color: var(--neon-green);
            padding: 0 4px;
            border-radius: 2px;
        }

        /* === CHECKLISTS === */
        .check-green i { color: var(--neon-green); }
        .check-red i { color: var(--alert-red); }

        /* === MODAL === */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 9999; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <!-- URGENCY BAR -->
    <div class="fixed top-0 w-full z-50 bg-red-700 text-white text-center py-2 px-4 text-xs md:text-sm font-bold uppercase tracking-wide shadow-lg">
        <i class="fas fa-exclamation-triangle mr-2 animate-pulse"></i> 
        <span id="top-bar-text">Limited Spots Available For This Workshop</span>
        <span class="hidden md:inline"> | </span>
        <span class="block md:inline text-yellow-300" id="top-bar-spots"></span>
    </div>

    <!-- HERO SECTION -->
    <header class="pt-24 pb-16 px-4 bg-[url('https://images.unsplash.com/photo-1556761175-5973dc0f32e7?q=80&w=2000')] bg-cover bg-center relative">
        <div class="absolute inset-0 bg-gradient-to-b from-black via-black/90 to-[#080808]"></div>
        
        <div class="relative z-10 max-w-4xl mx-auto text-center">
            
            <!-- Pre-Headline Authority -->
            <div class="inline-block border border-gray-600 bg-gray-900/80 rounded-full px-4 py-1 text-xs font-bold text-gray-300 mb-6 uppercase tracking-widest" id="hero-badge">
                Loading...
            </div>

            <!-- Headline -->
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-heading font-bold leading-tight text-white mb-6 drop-shadow-xl" id="hero-headline">
                <!-- JS -->
            </h1>

            <!-- Subheadline -->
            <p class="text-lg md:text-2xl text-gray-300 font-light leading-relaxed mb-8 max-w-3xl mx-auto" id="hero-subtitle">
                <!-- JS -->
            </p>

            <!-- Progress Bar Scarcity -->
            <div class="max-w-md mx-auto mb-8">
                <div class="flex justify-between text-xs font-bold uppercase text-gray-400 mb-1">
                    <span>Registration Status</span>
                    <span class="text-red-500">85% Full</span>
                </div>
                <div class="progress-container">
                    <div class="progress-bar" style="width: 85%;"></div>
                </div>
            </div>

            <!-- HERO CTA -->
            <button onclick="openModal()" class="btn-pulse text-2xl md:text-3xl px-12 py-6 w-full md:w-auto rounded-lg shadow-2xl animate-bounce-slow">
                <span id="hero-cta">YES! RESERVE MY SEAT NOW</span>
                <i class="fas fa-angle-double-right ml-3"></i>
            </button>
            
            <p class="mt-4 text-xs text-gray-500 uppercase tracking-widest">
                <i class="fas fa-lock text-green-500"></i> 100% Free Class â€¢ No Credit Card Required
            </p>
        </div>
    </header>

    <!-- THE "PROBLEM" (Agitation) -->
    <section class="py-16 px-4 bg-[#080808] border-b border-gray-900">
        <div class="max-w-3xl mx-auto">
            <div class="bg-[#111] border-l-4 border-red-600 p-8 rounded-r-lg shadow-lg">
                <h2 class="text-2xl md:text-3xl font-heading font-bold text-white mb-6" id="problems-title"></h2>
                <ul class="space-y-4 text-gray-300 text-lg" id="problems-list">
                    <!-- JS -->
                </ul>
            </div>
        </div>
    </section>

    <!-- THE "SOLUTION" (3-Day Breakdown) -->
    <section class="py-20 px-4 bg-[#050505]">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-16">
                <h2 class="text-3xl md:text-5xl font-heading font-bold text-white uppercase">
                    Here Is The <span class="text-green-500 underline decoration-4 decoration-green-500/30">Exact Roadmap</span> We Will Follow
                </h2>
            </div>

            <div class="grid md:grid-cols-3 gap-6" id="roadmap-grid">
                <!-- JS Injected -->
            </div>
        </div>
    </section>

    <!-- THE "GAP" (Comparison Table) -->
    <section class="py-20 px-4 bg-[#0c0c0c]">
        <div class="max-w-5xl mx-auto">
            <div class="funnel-card overflow-hidden">
                <div class="grid grid-cols-2 text-center border-b border-gray-800">
                    <div class="p-6 bg-red-900/20">
                        <h3 class="text-2xl font-heading font-bold text-red-500">THE HARD WAY</h3>
                        <p class="text-xs text-red-400 opacity-70 uppercase">(Doing it alone)</p>
                    </div>
                    <div class="p-6 bg-green-900/20 border-l border-gray-800 relative">
                        <div class="absolute top-0 right-0 bg-green-500 text-black text-[10px] font-bold px-2 py-1 uppercase">Recommended</div>
                        <h3 class="text-2xl font-heading font-bold text-green-500">THE SMART WAY</h3>
                        <p class="text-xs text-green-400 opacity-70 uppercase">(With This Blueprint)</p>
                    </div>
                </div>
                <div id="comparison-rows">
                    <!-- JS -->
                </div>
            </div>
            
            <div class="text-center mt-12">
                <button onclick="openModal()" class="btn-pulse text-xl px-10 py-4 rounded-lg">
                    I CHOOSE THE SMART WAY <i class="fas fa-check-circle ml-2"></i>
                </button>
            </div>
        </div>
    </section>

    <!-- THE DETAILS (Triptych) -->
    <section class="py-16 px-4 bg-white text-black">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-center text-4xl font-heading font-bold mb-12 text-black">EVENT DETAILS</h2>
            <div class="grid md:grid-cols-3 gap-8 text-center">
                <div class="p-6 border-2 border-gray-100 rounded-xl shadow-sm">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl text-blue-600">
                        <i class="fas fa-calendar-day"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 uppercase">When</h3>
                    <p class="text-gray-600 font-medium" id="detail-when"></p>
                </div>
                <div class="p-6 border-2 border-gray-100 rounded-xl shadow-sm">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl text-red-600">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 uppercase">Where</h3>
                    <p class="text-gray-600 font-medium" id="detail-where"></p>
                </div>
                <div class="p-6 border-2 border-gray-100 rounded-xl shadow-sm">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl text-green-600">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 uppercase">Cost</h3>
                    <p class="text-gray-600 font-medium">100% FREE (For Now)</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SOCIAL PROOF (Speakers) -->
    <section class="py-20 px-4 bg-[#080808] border-t border-gray-900">
        <div class="max-w-6xl mx-auto text-center">
            <h2 class="text-3xl md:text-5xl font-heading font-bold text-white mb-16" id="speakers-title"></h2>
            <div class="grid md:grid-cols-4 gap-6" id="speakers-grid">
                <!-- JS -->
            </div>
        </div>
    </section>

    <!-- FAQ -->
    <section class="py-16 px-4 bg-[#050505]">
        <div class="max-w-3xl mx-auto">
            <h2 class="text-center text-3xl font-heading font-bold text-white mb-10" id="faq-title"></h2>
            <div class="space-y-4" id="faq-list">
                <!-- JS -->
            </div>
        </div>
    </section>

    <!-- FOOTER CTA -->
    <section class="py-24 px-4 bg-gradient-to-b from-[#111] to-black text-center">
        <div class="max-w-3xl mx-auto">
            <h2 class="text-4xl md:text-6xl font-heading font-bold text-white leading-tight mb-6" id="footer-title"></h2>
            <p class="text-xl text-gray-400 mb-10" id="footer-note"></p>
            
            <button onclick="openModal()" class="btn-pulse text-2xl md:text-4xl px-12 py-6 w-full md:w-auto rounded-lg shadow-2xl">
                SECURE MY FREE TICKET NOW
            </button>
            <p class="text-xs text-red-500 mt-4 font-bold uppercase tracking-widest" id="footer-urgency"></p>
        </div>
    </section>

    <!-- LEGAL FOOTER -->
    <footer class="bg-black py-8 text-center text-gray-600 text-xs border-t border-gray-900">
        <div class="container mx-auto px-4">
            <p id="footer-copy"></p>
            <p id="footer-brokerage" class="mt-1 font-bold text-gray-500"></p>
            <div class="mt-4 space-x-4">
                <a href="#" class="hover:text-white">Privacy Policy</a>
                <span>|</span>
                <a href="#" class="hover:text-white">Terms of Service</a>
            </div>
        </div>
    </footer>

    <!-- MODAL (The Squeeze) -->
    <div class="modal-overlay" id="modal">
        <div class="bg-white text-black rounded-lg w-full max-w-md mx-4 relative overflow-hidden shadow-2xl animate-fade-in-up">
            <!-- Header -->
            <div class="bg-gray-100 p-4 border-b border-gray-200 flex justify-between items-center">
                <span class="font-bold text-sm uppercase tracking-wide text-gray-500">Step 1 of 2</span>
                <button onclick="closeModal()" class="text-gray-400 hover:text-red-500 text-2xl font-bold">&times;</button>
            </div>
            <div class="h-2 bg-gray-200 w-full">
                <div class="h-full bg-green-500 w-1/2 transition-all duration-500" id="modal-progress"></div>
            </div>

            <!-- Content -->
            <div class="p-8" id="modal-content">
                <div class="text-center mb-6">
                    <h3 class="text-2xl font-heading font-bold mb-2">Almost There!</h3>
                    <p class="text-gray-600 text-sm">Enter your details below to secure your spot.</p>
                </div>

                <form id="regForm" class="space-y-4">
                    <div>
                        <input type="text" name="firstName" class="w-full bg-gray-50 border border-gray-300 p-4 rounded font-bold focus:ring-2 focus:ring-green-500 outline-none" placeholder="First Name" required>
                    </div>
                    <div>
                        <input type="text" name="lastName" class="w-full bg-gray-50 border border-gray-300 p-4 rounded font-bold focus:ring-2 focus:ring-green-500 outline-none" placeholder="Last Name" required>
                    </div>
                    <div>
                        <input type="email" name="email" class="w-full bg-gray-50 border border-gray-300 p-4 rounded font-bold focus:ring-2 focus:ring-green-500 outline-none" placeholder="Best Email Address" required>
                    </div>
                    <div>
                        <input type="tel" name="phone" class="w-full bg-gray-50 border border-gray-300 p-4 rounded font-bold focus:ring-2 focus:ring-green-500 outline-none" placeholder="Mobile Number" required>
                    </div>
                    <button type="submit" id="modalBtn" class="btn-pulse w-full py-4 text-xl rounded">
                        Next Step <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </form>
                <p class="text-center text-[10px] text-gray-400 mt-4"><i class="fas fa-lock"></i> Information is secure.</p>
            </div>
        </div>
    </div>

    <!-- MAIN LOGIC -->
    <script>
        // --- HELPER FUNCTIONS ---
        function inject(id, content, isHtml = false) {
            const el = document.getElementById(id);
            if(el) {
                if(isHtml) el.innerHTML = content;
                else el.textContent = content;
            }
        }

        function hideEmptySections() {
            const sections = [
                { id: 'roadmap-grid', check: () => !config.solutions?.items || config.solutions.items.length === 0 },
                { id: 'comparison-rows', check: () => !config.comparison?.painfulWay?.points || !config.comparison?.expressWay?.points },
                { id: 'speakers-grid', check: () => !config.speakers?.experts || config.speakers.experts.length === 0 },
                { id: 'faq-list', check: () => !config.faq?.questions || config.faq.questions.length === 0 }
            ];
            sections.forEach(section => {
                const el = document.getElementById(section.id);
                if(el && section.check()) {
                    el.closest('section')?.style.setProperty('display', 'none');
                }
            });
        }

        function waitForConfig(callback) {
            if(typeof config !== 'undefined' && config.meta) {
                callback();
            } else {
                let attempts = 0;
                const checkConfig = setInterval(() => {
                    attempts++;
                    if(typeof config !== 'undefined' && config.meta) {
                        clearInterval(checkConfig);
                        callback();
                    } else if(attempts > 50) {
                        clearInterval(checkConfig);
                        console.error('Config failed to load after 5 seconds');
                    }
                }, 100);
            }
        }

        // --- INITIALIZATION ---
        waitForConfig(() => {
            document.title = config.meta.pageTitle;

            // TOP BAR
            inject('top-bar-text', config.header.eventDate);
            inject('top-bar-spots', config.header.spotsAvailable, true);

            // HERO
            inject('hero-badge', config.hero.badge);
            inject('hero-headline', config.hero.headline.replace(/class='highlight'/g, "class='text-green-400 font-bold'"), true);
            inject('hero-subtitle', config.hero.subtitle, true);
            inject('hero-cta', config.hero.ctaText);

            // PROBLEMS
            inject('problems-title', config.problems.title);
            if(config.problems.items) {
                inject('problems-list', config.problems.items.map(item => `
                    <li class="flex items-start gap-3">
                        <i class="fas fa-times-circle text-red-500 mt-1 text-xl"></i>
                        <span>${item}</span>
                    </li>
                `).join(''), true);
            }

            // ROADMAP
            if(config.solutions?.items && config.solutions.items.length > 0) {
                const items = config.solutions.items;
                const days = [items.slice(0,2), items.slice(2,4), items.slice(4,6)];
                const dayTitles = ["Frame The Strategy", "Build The Plan", "Launch Your Journey"];

                const roadHtml = days.map((dayItems, i) => `
                    <div class="funnel-card p-6 relative">
                        <div class="absolute -top-4 left-1/2 -translate-x-1/2 bg-green-600 text-black font-black px-4 py-1 rounded text-sm uppercase tracking-wide border-2 border-white">
                            STEP ${i+1}
                        </div>
                        <h3 class="text-center text-4xl font-heading font-bold text-green-500 mt-4 mb-2">PHASE ${i+1}</h3>
                        <div class="text-center text-xs text-gray-400 font-bold uppercase mb-4 border-b border-gray-800 pb-4">
                            <i class="far fa-calendar-alt"></i> <span>DATE TBA</span>
                        </div>
                        <h4 class="text-center text-lg font-bold text-white mb-6">${dayTitles[i]}</h4>
                        <div class="space-y-3">
                            ${dayItems.map(item => `
                                <div class="bg-white text-black rounded p-3 text-sm font-bold flex gap-3 items-start">
                                    <i class="fas fa-check-circle text-green-600 mt-1"></i>
                                    <span>${item.replace(/<[^>]*>/g, '')}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
                inject('roadmap-grid', roadHtml, true);
            }

            // DETAILS
            inject('detail-when', (config.event?.date || '') + (config.event?.time ? "<br>" + config.event.time : ''), true);
            inject('detail-where', config.event?.location || '');

            // COMPARISON - Build proper table rows
            if(config.comparison?.painfulWay?.points && config.comparison?.expressWay?.points) {
                const maxPoints = Math.max(config.comparison.painfulWay.points.length, config.comparison.expressWay.points.length);
                const comparisonRows = [];
                for(let i = 0; i < maxPoints; i++) {
                    const painfulPoint = config.comparison.painfulWay.points[i] || '';
                    const expressPoint = config.comparison.expressWay.points[i] || '';
                    comparisonRows.push(`
                        <div class="grid grid-cols-2 border-b border-gray-800">
                            <div class="p-4 border-r border-gray-800">
                                <div class="flex items-start gap-3 text-sm md:text-base text-gray-400">
                                    <i class="fas fa-times text-red-500 mt-1"></i>
                                    <span>${painfulPoint}</span>
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="flex items-start gap-3 text-sm md:text-base font-medium text-white">
                                    <i class="fas fa-check text-green-500 mt-1"></i>
                                    <span>${expressPoint}</span>
                                </div>
                            </div>
                        </div>
                    `);
                }
                inject('comparison-rows', comparisonRows.join(''), true);
            }

            // SPEAKERS (Headshots)
            inject('speakers-title', config.speakers?.title || '');
            if(config.speakers?.experts && config.speakers.experts.length > 0) {
                inject('speakers-grid', config.speakers.experts.map(exp => `
                    <div class="text-center group">
                        <div class="w-32 h-32 mx-auto rounded-full overflow-hidden border-4 border-green-500 shadow-xl mb-4 grayscale group-hover:grayscale-0 transition-all duration-500">
                            <img src="${exp.headshotUrl}" class="w-full h-full object-cover" onerror="this.src='https://via.placeholder.com/150'">
                        </div>
                        <h3 class="font-bold text-xl text-white uppercase">${exp.name}</h3>
                        <p class="text-xs text-green-500 font-bold uppercase tracking-wide mb-2">${exp.title}</p>
                    </div>
                `).join(''), true);
            }

            // FAQ
            inject('faq-title', config.faq?.title || '');
            if(config.faq?.questions && config.faq.questions.length > 0) {
                inject('faq-list', config.faq.questions.map(q => `
                    <div class="border border-gray-800 rounded bg-[#111] overflow-hidden">
                        <button class="w-full text-left p-4 font-bold text-white flex justify-between items-center focus:outline-none hover:bg-gray-900 transition-colors" onclick="toggleFaq(this)">
                            <span>${q.question}</span>
                            <i class="fas fa-plus text-green-500"></i>
                        </button>
                        <div class="hidden p-4 text-gray-400 text-sm border-t border-gray-800 bg-black">
                            ${q.answer}
                        </div>
                    </div>
                `).join(''), true);
            }

            // FOOTER
            inject('footer-copy', config.footer?.copyright || '');
            inject('footer-brokerage', config.footer?.brokerage || '');
            inject('footer-title', config.registration?.title || '');
            inject('footer-note', config.registration?.note || '');
            inject('footer-urgency', config.registration?.urgency || '', true);

            // Hide empty sections
            hideEmptySections();

            // MODAL LOGIC
            initModal();
        });

        // --- INTERACTION ---
        function toggleFaq(btn) {
            const content = btn.nextElementSibling;
            const icon = btn.querySelector('i');
            if(content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                icon.classList.remove('fa-plus');
                icon.classList.add('fa-minus');
            } else {
                content.classList.add('hidden');
                icon.classList.remove('fa-minus');
                icon.classList.add('fa-plus');
            }
        }

        function openModal() {
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function initModal() {
            const form = document.getElementById('regForm');
            const modalContent = document.getElementById('modal-content');
            let userData = {};

            // Step 1: Form Submit
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                userData = Object.fromEntries(formData);
                
                // Show Loading
                document.getElementById('modalBtn').innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> PROCESSING...';
                
                // Go to Questions
                setTimeout(() => startQuestions(), 800);
            });

            // Step 2: Questions
            function startQuestions() {
                let currentQ = 0;
                let answers = [];
                const questions = config.modalQuestions;

                function renderQ() {
                    if(currentQ >= questions.length) {
                        finish();
                        return;
                    }
                    const q = questions[currentQ];
                    
                    // Update Progress Bar
                    const progress = ((currentQ + 1) / (questions.length + 1)) * 100;
                    document.getElementById('modal-progress').style.width = progress + '%';

                    let optionsHtml = q.options.map(opt => `
                        <button class="w-full text-left p-4 mb-2 border border-gray-200 rounded hover:bg-green-50 hover:border-green-500 transition-all font-bold text-gray-700 group flex items-center gap-3" onclick="handleAnswer('${q.id}', '${q.questionText}', '${opt.value}', '${opt.text.replace(/'/g, "\\'")}')">
                            <div class="w-5 h-5 rounded-full border-2 border-gray-300 group-hover:border-green-500 flex items-center justify-center">
                                <div class="w-3 h-3 rounded-full bg-green-500 opacity-0 group-hover:opacity-100"></div>
                            </div>
                            ${opt.text}
                        </button>
                    `).join('');

                    modalContent.innerHTML = `
                        <div class="text-center mb-6 animate-fade-in">
                            <h3 class="text-xl font-bold mb-4">${q.questionText}</h3>
                            <div>${optionsHtml}</div>
                        </div>
                    `;
                }

                window.handleAnswer = (questionId, qText, val, answerText) => {
                    answers.push({ 
                        questionId: questionId,
                        question: qText, 
                        answer: answerText || val
                    });
                    currentQ++;
                    renderQ();
                };

                renderQ();

                function finish() {
                    document.getElementById('modal-progress').style.width = '100%';
                    modalContent.innerHTML = `
                        <div class="text-center py-10">
                            <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4 text-green-600 text-4xl">
                                <i class="fas fa-check"></i>
                            </div>
                            <h2 class="text-3xl font-heading font-bold mb-2">YOU'RE IN!</h2>
                            <p class="text-gray-600 mb-4">Ticket sent to <strong>${userData.email}</strong></p>
                            <p class="text-xs text-gray-400">Check your spam folder if missing.</p>
                        </div>
                    `;
                    
                    // Update spots counter locally
                    if(config.event?.spotsLeft !== undefined) {
                        config.event.spotsLeft = Math.max(0, config.event.spotsLeft - 1);
                        const spotsText = config.header?.spotsAvailable || `Only ${config.event.spotsLeft} Spots Available`;
                        inject('top-bar-spots', spotsText.replace(/\d+/, config.event.spotsLeft), true);
                        inject('footer-urgency', config.registration?.urgency?.replace(/\d+/, config.event.spotsLeft) || '', true);
                    }
                    
                    // Send Data
                    const webhookUrl = (config.webhook?.enabled && config.webhook?.url) 
                        ? config.webhook.url 
                        : (config.deploymentInfo?.webhookUrl || '');
                    
                    if(webhookUrl) {
                        const timestamp = new Date().toISOString();
                        const payload = {
                            source: 'v11.html',
                            timestamp: timestamp,
                            submittedAt: timestamp,
                            firstName: userData.firstName || '',
                            lastName: userData.lastName || '',
                            email: userData.email || '',
                            phone: userData.phone || '',
                            agentEmail: config.contact?.agents?.[0]?.email || '',
                            questions: answers.map(a => ({
                                questionId: a.questionId,
                                question: a.question,
                                answer: a.answer
                            })),
                            campaign: config.event?.title || '',
                            deploymentInfo: config.deploymentInfo || {}
                        };
                        
                        fetch(webhookUrl, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify(payload)
                        }).catch(err => console.error('Webhook error:', err));
                    }
                }
            }
        }
    </script>
    
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</body>
</html>